{"ast":null,"code":"import _asyncToGenerator from \"/Users/erisveltonlima/Desktop/Projetos 2023/criancaFeliz2023/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { __decorate } from \"tslib\";\nimport __NG_CLI_RESOURCE__0 from \"./meus-dados.page.html?ngResource\";\nimport __NG_CLI_RESOURCE__1 from \"./meus-dados.page.scss?ngResource\";\nimport { HttpService } from './../../services/http.service';\nimport { Router } from '@angular/router';\nimport { Component } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { LoadingController, Platform, ToastController } from '@ionic/angular';\nimport { Camera, CameraResultType, CameraSource } from '@capacitor/camera';\nimport { Geolocation } from '@capacitor/geolocation';\nimport { NativeGeocoder } from '@awesome-cordova-plugins/native-geocoder/ngx';\nimport { GlobalComponent } from './../../global/global.component';\nimport { Storage } from '@ionic/storage-angular';\nimport { DomSanitizer } from '@angular/platform-browser';\nimport { servico } from '../../models/Servico';\nimport { Mentor } from 'src/app/models/Mentor';\nimport { NgxQrcodeElementTypes, NgxQrcodeErrorCorrectionLevels } from '@techiediaries/ngx-qrcode';\nimport { Clipboard } from '@capacitor/clipboard';\nconst IMAGE_DIR = 'stored-images';\nlet MeusDadosPage = class MeusDadosPage {\n  constructor(plt, http, loadingCtrl, toastCtrl, nativeGeocoder, globalComponent, router, storage, httpService, domSanitizer) {\n    this.plt = plt;\n    this.http = http;\n    this.loadingCtrl = loadingCtrl;\n    this.toastCtrl = toastCtrl;\n    this.nativeGeocoder = nativeGeocoder;\n    this.globalComponent = globalComponent;\n    this.router = router;\n    this.storage = storage;\n    this.httpService = httpService;\n    this.domSanitizer = domSanitizer;\n    this.title = 'Angular';\n    this.elementType = NgxQrcodeElementTypes.URL;\n    this.correctionLevel = NgxQrcodeErrorCorrectionLevels.HIGH;\n    this.temCoordenada = \"block\";\n    this.obj = servico;\n    this.imagem = \"\";\n    this.value = this.obj.usuarioLogado.codigoFormatado + \" \";\n    // images upload\n    this.images = [];\n    this.options = {\n      useLocale: true,\n      maxResults: 5\n    };\n    // http request\n    this.data = null;\n    this.myImage = null;\n    this.logo = \"\";\n    this.caracter = \"\";\n    this.global = globalComponent;\n    this.storage.create().then(a => {\n      this.storage.get('licenca').then(licenca => {\n        this.logo = licenca.logo;\n      });\n    });\n  }\n  ionViewDidEnter() {\n    if (this.obj.usuarioLogado.flagFoto == 1) {\n      this.imagem = Mentor.UrlRequest + \"/arquivo/individuos/individuo\" + this.obj.usuarioLogado.codigo + \"/foto\" + this.obj.usuarioLogado.codigo + \".png?aleatorio=\" + Math.random() * 10000;\n      var img = document.getElementById('imagem');\n      var width = img.clientWidth;\n      var height = img.clientHeight;\n      img.style.height = width + \"px\";\n      img.style.width = width + \"px\";\n      var qrs = document.getElementsByClassName(\"qrcode\")[0].childNodes[0];\n      qrs.style.width = width + \"px\";\n      qrs.style.height = width + \"px\";\n    }\n  }\n  ngOnInit() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      // storage\n      yield _this.storage.create();\n      if (_this.obj.usuarioLogado.latitude != \"\" || _this.obj.usuarioLogado.latitude != null) {\n        _this.temCoordenada = \"none\";\n      }\n      // load files\n    })();\n  }\n  // generic toast\n  loadToast() {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      const toast = yield _this2.toastCtrl.create({\n        message: 'hello world',\n        duration: 1500,\n        position: 'bottom'\n      });\n      yield toast.present();\n    })();\n  }\n  // Little helper\n  presentToast(text) {\n    var _this3 = this;\n    return _asyncToGenerator(function* () {\n      const toast = yield _this3.toastCtrl.create({\n        message: text,\n        duration: 3000\n      });\n      toast.present();\n    })();\n  }\n  copia() {\n    var valor = this.caracter - 0;\n    var palavra = this.imagem.substring(valor - 10, valor + 50);\n    Clipboard.write({\n      string: palavra\n    }).then(ok => {\n      alert(\"copiei \" + palavra);\n    }).catch(err => {\n      alert(err);\n      this.caracter = palavra;\n    });\n  }\n  tiraFoto() {\n    var _this4 = this;\n    return _asyncToGenerator(function* () {\n      let image = yield Camera.getPhoto({\n        quality: 60,\n        allowEditing: false,\n        resultType: CameraResultType.Base64,\n        source: CameraSource.Camera // Camera, Photos or Prompt!\n      });\n\n      if (image) {\n        _this4.imagem = \"data:image/jpeg;base64,\" + image.base64String;\n        // await Clipboard.write({\n        //   string: this.imagem\n        // });\n        //alert(this.imagem.length);\n        _this4.obj.usuarioLogado.flagFoto = 1;\n        _this4.obj.usuarioLogado.extensao = \".png\";\n        var img = document.getElementById('imagem');\n        var width = img.clientWidth;\n        var height = img.clientHeight;\n        img.style.height = width + \"px\";\n        img.style.width = width + \"px\";\n        var qrs = document.getElementsByClassName(\"qrcode\")[0].childNodes[0];\n        qrs.style.width = width + \"px\";\n        qrs.style.height = width + \"px\";\n        Mentor.rodaTransacaoFromObjeto(1789, \"obj\", servico.usuarioLogado, false);\n        const base64 = yield fetch(_this4.imagem);\n        const blob = yield base64.blob();\n        let formData = new FormData();\n        formData.append(\"arquivo\", blob);\n        formData.append(\"codigoIndividuo\", _this4.obj.usuarioLogado.codigo + \"\");\n        var oReq = new XMLHttpRequest();\n        oReq.open(\"POST\", Mentor.UrlRequest + \"jsp/salvarFotoIndividuo2.jsp\", true);\n        try {\n          oReq.send(formData);\n        } catch (err) {\n          alert(err);\n        }\n        //alert(oReq.responseText);\n        //var sImagem = JSON.stringify(this.imagem)\n        // var tamanho = Mentor.bind(\"codigoIndividuo=\" + this.obj.usuarioLogado.codigo + \"&base=\" + sImagem, \"/jsp/salvarFotoIndividuo.jsp\", \"POST\");\n        //alert(this.imagem.length + \" \" + tamanho);\n      }\n    })();\n  }\n\n  b64toBlob(dataURI) {\n    return _asyncToGenerator(function* () {\n      const rawData = atob(dataURI);\n      const bytes = new Array(rawData.length);\n      for (var x = 0; x < rawData.length; x++) {\n        bytes[x] = rawData.charCodeAt(x);\n      }\n      const arr = new Uint8Array(bytes);\n      return new Blob([arr], {\n        type: 'image/png'\n      });\n    })();\n  }\n  // geolocation\n  fetchLocation() {\n    var _this5 = this;\n    return _asyncToGenerator(function* () {\n      const location = yield Geolocation.getCurrentPosition();\n      console.log('localização: ', location);\n      _this5.nativeGeocoder.reverseGeocode(location.coords.latitude, location.coords.longitude, _this5.options).then(result => {\n        console.log('Resultado:', result);\n        console.log('Resultado 0:', result[0]);\n        let latitude = location.coords.latitude;\n        let longitude = location.coords.longitude;\n        servico.usuarioLogado.latitude = latitude;\n        servico.usuarioLogado.longitude = longitude;\n        _this5.temCoordenada = \"none\";\n        Mentor.rodaTransacaoFromObjeto(1789, \"obj\", servico.usuarioLogado, false);\n      });\n      const toast = yield _this5.toastCtrl.create({\n        message: 'Localização recebida com sucesso.',\n        duration: 1500,\n        position: 'bottom'\n      });\n      yield toast.present();\n    })();\n  }\n};\nMeusDadosPage.ctorParameters = () => [{\n  type: Platform\n}, {\n  type: HttpClient\n}, {\n  type: LoadingController\n}, {\n  type: ToastController\n}, {\n  type: NativeGeocoder\n}, {\n  type: GlobalComponent\n}, {\n  type: Router\n}, {\n  type: Storage\n}, {\n  type: HttpService\n}, {\n  type: DomSanitizer\n}];\nMeusDadosPage = __decorate([Component({\n  selector: 'app-meus-dados',\n  template: __NG_CLI_RESOURCE__0,\n  styles: [__NG_CLI_RESOURCE__1]\n})], MeusDadosPage);\nexport { MeusDadosPage };","map":{"version":3,"mappings":"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","names":["HttpService","Router","Component","HttpClient","LoadingController","Platform","ToastController","Camera","CameraResultType","CameraSource","Geolocation","NativeGeocoder","GlobalComponent","Storage","DomSanitizer","servico","Mentor","NgxQrcodeElementTypes","NgxQrcodeErrorCorrectionLevels","Clipboard","IMAGE_DIR","MeusDadosPage","constructor","plt","http","loadingCtrl","toastCtrl","nativeGeocoder","globalComponent","router","storage","httpService","domSanitizer","URL","HIGH","obj","usuarioLogado","codigoFormatado","useLocale","maxResults","global","create","then","a","get","licenca","logo","ionViewDidEnter","flagFoto","imagem","UrlRequest","codigo","Math","random","img","document","getElementById","width","clientWidth","height","clientHeight","style","qrs","getElementsByClassName","childNodes","ngOnInit","latitude","temCoordenada","loadToast","toast","message","duration","position","present","presentToast","text","copia","valor","caracter","palavra","substring","write","string","ok","alert","catch","err","tiraFoto","image","getPhoto","quality","allowEditing","resultType","Base64","source","base64String","extensao","rodaTransacaoFromObjeto","base64","fetch","blob","formData","FormData","append","oReq","XMLHttpRequest","open","send","b64toBlob","dataURI","rawData","atob","bytes","Array","length","x","charCodeAt","arr","Uint8Array","Blob","type","fetchLocation","location","getCurrentPosition","console","log","reverseGeocode","coords","longitude","options","result","selector","template"],"sourceRoot":"","sources":["/Users/erisveltonlima/Desktop/Projetos 2023/criancaFeliz2023/src/app/pages/meus-dados/meus-dados.page.ts"],"sourcesContent":["import { HttpService } from './../../services/http.service';\nimport { Router } from '@angular/router';\nimport { Component, OnInit } from '@angular/core';\nimport { Componente } from 'src/app/interfaces/interfaces';\nimport { Filesystem, Directory } from '@capacitor/filesystem';\nimport { HttpClient } from '@angular/common/http';\nimport { LoadingController, Platform, ToastController, PopoverController } from '@ionic/angular';\nimport { Camera, CameraResultType, CameraSource, Photo } from '@capacitor/camera';\nimport { finalize } from 'rxjs/operators';\nimport { Geolocation } from '@capacitor/geolocation';\nimport { NativeGeocoder, NativeGeocoderResult, NativeGeocoderOptions } from '@awesome-cordova-plugins/native-geocoder/ngx';\nimport { GlobalComponent } from './../../global/global.component';\nimport { Storage } from '@ionic/storage-angular';\nimport { DomSanitizer } from '@angular/platform-browser';\n\nimport { servico } from '../../models/Servico'\nimport { Mentor } from 'src/app/models/Mentor';\nimport { NgxQrcodeElementTypes, NgxQrcodeErrorCorrectionLevels } from '@techiediaries/ngx-qrcode';\n\nimport { Clipboard } from '@capacitor/clipboard';\nimport { Estado, licencaMunicipioSistema } from 'src/app/models/Modelo';\n\n\n\n\nconst IMAGE_DIR = 'stored-images';\ninterface LocalFile {\n  name: string;\n  path: string;\n  data: string;\n}\n@Component({\n  selector: 'app-meus-dados',\n  templateUrl: './meus-dados.page.html',\n  styleUrls: ['./meus-dados.page.scss'],\n})\nexport class MeusDadosPage implements OnInit {\n\n\n  title = 'Angular';\n  elementType = NgxQrcodeElementTypes.URL;\n  correctionLevel = NgxQrcodeErrorCorrectionLevels.HIGH;\n  margin: 2;\n  scale: 0;\n  width: 1000;\n\n  temCoordenada = \"block\";\n\n\n\n  obj = servico;\n\n  imagem = \"\";\n\n  value = this.obj.usuarioLogado.codigoFormatado + \" \";\n\n\n  // login\n  req_cpf: any;\n  req_param: any;\n\n  // global\n  global: any;\n\n  // images upload\n  images: LocalFile[] = [];\n\n  options: NativeGeocoderOptions = {\n    useLocale: true,\n    maxResults: 5\n  };\n\n  // geolocation - clean\n  geoAddress: any;\n\n  // http request\n  data = null;\n  myImage = null;\n\n  ionViewDidEnter() {\n\n    if (this.obj.usuarioLogado.flagFoto == 1) {\n      this.imagem = Mentor.UrlRequest + \"/arquivo/individuos/individuo\" + this.obj.usuarioLogado.codigo + \"/foto\" + this.obj.usuarioLogado.codigo + \".png?aleatorio=\" + (Math.random() * 10000);\n\n      var img = document.getElementById('imagem');\n\n\n      var width = img.clientWidth;\n      var height = img.clientHeight;\n\n      img.style.height = width + \"px\";\n      img.style.width = width + \"px\";\n\n\n\n      var qrs: any = document.getElementsByClassName(\"qrcode\")[0].childNodes[0];\n      qrs.style.width = width + \"px\";\n      qrs.style.height = width + \"px\";\n\n    }\n   \n  }\n\n  logo: String = \"\";\n  \n  constructor(\n    private plt: Platform,\n    private http: HttpClient,\n    private loadingCtrl: LoadingController,\n    private toastCtrl: ToastController,\n    private nativeGeocoder: NativeGeocoder,\n    public globalComponent: GlobalComponent,\n    public router: Router,\n    private storage: Storage,\n    private httpService: HttpService,\n    private domSanitizer: DomSanitizer\n  ) {\n    this.global = globalComponent;\n\n    this.storage.create().then(a => {\n      this.storage.get('licenca').then(licenca => {\n\n        this.logo = licenca.logo;\n      }\n\n      );\n    });\n\n  }\n\n\n\n\n  async ngOnInit() {\n    // storage\n    await this.storage.create();\n\n if (this.obj.usuarioLogado.latitude != \"\" || this.obj.usuarioLogado.latitude != null) {\n      this.temCoordenada = \"none\"\n    }\n    // load files\n  }\n\n  // generic toast\n  async loadToast() {\n    const toast = await this.toastCtrl.create({\n      message: 'hello world',\n      duration: 1500,\n      position: 'bottom'\n    });\n\n    await toast.present();\n  }\n\n\n\n\n  // Little helper\n  async presentToast(text) {\n    const toast = await this.toastCtrl.create({\n      message: text,\n      duration: 3000\n    });\n    toast.present();\n  }\n\n  caracter: any = \"\"\n\n  copia() {\n\n    var valor = this.caracter - 0;\n\n    var palavra = this.imagem.substring(valor - 10, valor + 50);\n\n\n    Clipboard.write({\n      string: palavra\n    }).then(ok => { alert(\"copiei \" + palavra) }).catch(err => { alert(err); this.caracter = palavra });\n\n\n  }\n\n\n  async tiraFoto() {\n    let image: any = await Camera.getPhoto({\n      quality: 60,\n      allowEditing: false,\n      resultType: CameraResultType.Base64,\n      source: CameraSource.Camera // Camera, Photos or Prompt!\n    });\n\n\n\n    if (image) {\n\n\n\n\n\n\n\n      this.imagem = \"data:image/jpeg;base64,\" + image.base64String;\n      // await Clipboard.write({\n      //   string: this.imagem\n      // });\n      //alert(this.imagem.length);\n      this.obj.usuarioLogado.flagFoto = 1;\n      this.obj.usuarioLogado.extensao = \".png\";\n\n      var img = document.getElementById('imagem');\n\n\n      var width = img.clientWidth;\n      var height = img.clientHeight;\n\n      img.style.height = width + \"px\";\n      img.style.width = width + \"px\";\n\n      var qrs: any = document.getElementsByClassName(\"qrcode\")[0].childNodes[0];\n      qrs.style.width = width + \"px\";\n      qrs.style.height = width + \"px\";\n\n\n\n      Mentor.rodaTransacaoFromObjeto(1789, \"obj\", servico.usuarioLogado, false);\n\n\n      const base64 = await fetch(this.imagem);\n\n      const blob = await base64.blob();\n\n      let formData = new FormData();\n      formData.append(\"arquivo\", blob);\n      formData.append(\"codigoIndividuo\", this.obj.usuarioLogado.codigo + \"\");\n\n\n\n      var oReq = new XMLHttpRequest();\n      oReq.open(\"POST\", Mentor.UrlRequest + \"jsp/salvarFotoIndividuo2.jsp\", true);\n\n\n      try {\n\n        oReq.send(formData);\n      } catch (err) {\n        alert(err)\n      }\n\n\n\n      //alert(oReq.responseText);\n\n      //var sImagem = JSON.stringify(this.imagem)\n\n      // var tamanho = Mentor.bind(\"codigoIndividuo=\" + this.obj.usuarioLogado.codigo + \"&base=\" + sImagem, \"/jsp/salvarFotoIndividuo.jsp\", \"POST\");\n\n      //alert(this.imagem.length + \" \" + tamanho);\n    }\n  }\n\n\n  async b64toBlob(dataURI) {\n\n\n    const rawData = atob(dataURI);\n    const bytes = new Array(rawData.length);\n    for (var x = 0; x < rawData.length; x++) {\n      bytes[x] = rawData.charCodeAt(x);\n    }\n    const arr = new Uint8Array(bytes);\n    return new Blob([arr], { type: 'image/png' });\n\n  }\n\n\n  // geolocation\n  async fetchLocation() {\n\n    const location = await Geolocation.getCurrentPosition();\n    console.log('localização: ', location);\n\n\n\n    this.nativeGeocoder.reverseGeocode(location.coords.latitude, location.coords.longitude, this.options)\n      .then((result: NativeGeocoderResult[]) => {\n        console.log('Resultado:', result);\n        console.log('Resultado 0:', result[0]);\n\n\n        let latitude = location.coords.latitude;\n        let longitude = location.coords.longitude;\n        servico.usuarioLogado.latitude = latitude;\n        servico.usuarioLogado.longitude = longitude;\n        \n          this.temCoordenada = \"none\"\n\n\n          Mentor.rodaTransacaoFromObjeto(1789, \"obj\", servico.usuarioLogado, false);\n\n        });\n\n    const toast = await this.toastCtrl.create({\n      message: 'Localização recebida com sucesso.',\n      duration: 1500,\n      position: 'bottom'\n    });\n\n    await toast.present();\n\n  }\n\n\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}