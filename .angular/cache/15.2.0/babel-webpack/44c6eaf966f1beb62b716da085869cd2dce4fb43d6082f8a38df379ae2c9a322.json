{"ast":null,"code":"import _asyncToGenerator from \"/Users/erisveltonlima/Desktop/Projetos 2023/criancaFeliz2023/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { __decorate } from \"tslib\";\nimport __NG_CLI_RESOURCE__0 from \"./login.page.html?ngResource\";\nimport __NG_CLI_RESOURCE__1 from \"./login.page.scss?ngResource\";\nimport { GlobalComponent } from './../../global/global.component';\nimport { Router } from '@angular/router';\nimport { Component } from '@angular/core';\nimport { Storage } from '@ionic/storage-angular';\nimport { AlertController } from '@ionic/angular';\nimport { Mentor } from '../../models/Mentor';\nimport { Funcionarios } from '../../models/Modelo';\nimport { servico } from '../../models/Servico';\nimport { Controlador } from '../../models/Controlador';\nimport { LoadingController } from '@ionic/angular';\nlet LoginPage = class LoginPage {\n  constructor(router, globalComponent, storage, loadingCtrl, alertController) {\n    this.router = router;\n    this.globalComponent = globalComponent;\n    this.storage = storage;\n    this.loadingCtrl = loadingCtrl;\n    this.alertController = alertController;\n    this.cpf = \"037.189.414-06\";\n    this.senha = \"Velton250380\";\n    this.load = null;\n    this.municipio = null;\n    this.logo = \"/assets/images/examples/carregamento.png\";\n    this.servidorLogado = null;\n    this.showSpinner = false;\n    this.ctrl = new Controlador();\n    this.criancas = new Array();\n    this.gestantes = new Array();\n    this.global = this.globalComponent;\n    loadingCtrl.create({\n      message: \"Conectando Servidor.\"\n    }).then(l => {\n      this.load = l;\n    });\n  }\n  presentAlert() {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      const alert = yield _this.alertController.create({\n        header: 'Importante',\n        message: \"Para acessar o aplicativo, é preciso estar inscrito no Cadastro Único Federal Procure uma Unidade de Assistência Social (CRAS) ou a Central do Cadastro Único mais próxima.\",\n        buttons: ['OK']\n      });\n      yield alert.present();\n    })();\n  }\n  //alerta para informar o CPF\n  alertaCpf() {\n    var _this2 = this;\n    return _asyncToGenerator(function* () {\n      const alert = yield _this2.alertController.create({\n        header: 'Importante',\n        message: \"Por favor, preencha seu CPF corretamente .\",\n        buttons: ['OK']\n      });\n      yield alert.present();\n    })();\n  }\n  //alerta para informar a senha\n  alertaSenha() {\n    var _this3 = this;\n    return _asyncToGenerator(function* () {\n      const alert = yield _this3.alertController.create({\n        header: 'Importante',\n        message: \"Por favor, preencha sua data de nascimento.\",\n        buttons: ['OK']\n      });\n      yield alert.present();\n    })();\n  }\n  // form login\n  loginForm() {\n    //  console.log('Data Requerida: ', e.value);\n    if (this.cpf == '' || this.cpf == undefined) {\n      //this.globalComponent.loadToast('Por favor, preencha seu e-mail corretamente');\n      return this.alertaCpf();\n    } else if (this.senha == '' || this.senha == undefined) {\n      //this.globalComponent.loadToast('Por favor, preencha sua data de nascimento');\n      return this.alertaSenha();\n    } else {\n      this.load.present();\n      setTimeout(() => {\n        this.loginForm2();\n      }, 100);\n      return;\n      // tentar fazer login\n      var usuario = Mentor.executaVisao(1171, \"varcpf=\" + this.cpf + \"&varsenha=\" + this.senha);\n      this.load.dismiss();\n      if (usuario == null) {\n        alert(\"nenhum usuario encontrado\");\n        return;\n      }\n      servico.imagem;\n      if (usuario.associadoCras != null && usuario.associadoCras.domicilioCras != null && usuario.associadoCras.domicilioCras.historicoUnidades != null) {\n        for (var x = 0; x < usuario.associadoCras.domicilioCras.historicoUnidades.length; x++) if (usuario.associadoCras.domicilioCras.historicoUnidades[x].dataFimFormatado == \"\" && usuario.associadoCras.domicilioCras.historicoUnidades[x].unidade != null) servico.cras = usuario.associadoCras.domicilioCras.historicoUnidades[x].unidade;\n      }\n      this.storage.set(\"ultimoUsuario\", usuario);\n      servico.usuarioLogado = usuario;\n      if (usuario.dataUltimoAcessoAppFormatado == null) {\n        usuario.dataUltimoAcessoApp = new Date();\n        usuario.dataUltimoAcessoAppFormatado = Mentor.dateToString(new Date());\n      }\n      //var mensagens = Mentor.executaVisao(3071, \"\");\n      var parametro = \"individuo=\" + servico.usuarioLogado.codigo;\n      if (servico.cras != null) parametro = parametro + \"&unidade=\" + servico.cras.codigo;\n      var palavra = Mentor.bind(parametro, \"/jsp/appCidadao/listaMensagens.jsp\", \"POST\");\n      var mensagens = eval(palavra + \"\");\n      if (mensagens != null) {\n        for (var x = 0; x < mensagens.length; x++) {\n          if (Mentor.stringToDate(mensagens[x].publicacaoFormatado).getTime() > Mentor.stringToDate(usuario.dataUltimoAcessoAppFormatado).getTime()) servico.temMensagemNova = true;\n        }\n      }\n      servico.dataUltimoAcessoApp = Mentor.stringToDate(usuario.dataUltimoAcessoAppFormatado);\n      usuario.dataUltimoAcessoApp = new Date();\n      Mentor.rodaTransacaoFromObjeto(1788, \"obj\", usuario, false);\n      let url = '/tabs/meus-dados';\n      //let url_withparameter = '/tabs/meus-dados?cpf=' + e.value.login_cpf + '&nascimento=' + e.value.login_nascimento;\n      this.storage.set('cpf', this.cpf);\n      this.router.navigateByUrl(url);\n    }\n  }\n  loginForm2() {\n    //  console.log('Data Requerida: ', e.value);\n    {\n      // tentar fazer login\n      var lServidor = Mentor.executaVisao(1171, \"varcpf=\" + this.cpf + \"&varsenha=\" + this.senha);\n      if (lServidor == null) {\n        var funcionario = new Funcionarios(lServidor);\n        this.storage.set(\"servidor\", funcionario);\n        this.load.dismiss();\n        alert(\"nenhum usuario encontrado\");\n        return;\n      }\n      servico.imagem;\n      if (lServidor.associadoCras != null && lServidor.associadoCras.domicilioCras != null && lServidor.associadoCras.domicilioCras.historicoUnidades != null) {\n        for (var x = 0; x < lServidor.associadoCras.domicilioCras.historicoUnidades.length; x++) if (lServidor.associadoCras.domicilioCras.historicoUnidades[x].dataFimFormatado == \"\" && lServidor.associadoCras.domicilioCras.historicoUnidades[x].unidade != null) servico.cras = lServidor.associadoCras.domicilioCras.historicoUnidades[x].unidade;\n      }\n      this.storage.set(\"ultimoUsuario\", lServidor);\n      servico.usuarioLogado = lServidor;\n      if (lServidor.dataUltimoAcessoAppFormatado == null) {\n        lServidor.dataUltimoAcessoApp = new Date();\n        lServidor.dataUltimoAcessoAppFormatado = Mentor.dateToString(new Date());\n      }\n      //var mensagens = Mentor.executaVisao(3071, \"\");\n      var parametro = \"individuo=\" + servico.usuarioLogado.codigo;\n      if (servico.cras != null) parametro = parametro + \"&unidade=\" + servico.cras.codigo;\n      var palavra = Mentor.bind(parametro, \"/jsp/appCidadao/listaMensagens.jsp\", \"POST\");\n      var mensagens = eval(palavra + \"\");\n      if (mensagens != null) {\n        for (var x = 0; x < mensagens.length; x++) {\n          if (Mentor.stringToDate(mensagens[x].publicacaoFormatado).getTime() > Mentor.stringToDate(lServidor.dataUltimoAcessoAppFormatado).getTime()) servico.temMensagemNova = true;\n        }\n      }\n      servico.dataUltimoAcessoApp = Mentor.stringToDate(lServidor.dataUltimoAcessoAppFormatado);\n      lServidor.dataUltimoAcessoApp = new Date();\n      Mentor.rodaTransacaoFromObjeto(1788, \"obj\", lServidor, false);\n      let url = '/tabs/meus-dados';\n      //let url_withparameter = '/tabs/meus-dados?cpf=' + e.value.login_cpf + '&nascimento=' + e.value.login_nascimento;\n      this.storage.set('cpf', this.cpf);\n      this.load.dismiss();\n      this.router.navigateByUrl(url);\n    }\n  }\n  ionViewDidEnter() {\n    var _this4 = this;\n    return _asyncToGenerator(function* () {\n      yield _this4.storage.create();\n      var licenca = yield _this4.storage.get('licenca');\n      //alert(licenca);\n      if (licenca == null) {\n        _this4.router.navigateByUrl('selecao-municipio');\n      } else {\n        Mentor.UrlRequest = \"https://app.conectasuas.com.br/assistenciaSocial/\";\n        //\"http://app.vvision.com.br:8080/assistenciaSocial/\";\n        var licencas = Mentor.executaVisao(2632, \"varcodigo=\" + licenca.estado.codigo + \"&varsistema=\" + licenca.sistema + \"&varnomeMunicipio=\" + licenca.nomeMunicipio);\n        if (licencas == null || licencas.length != 1) _this4.router.navigateByUrl('selecao-municipio');else {\n          licenca = licencas[0];\n          _this4.storage.set(\"licenca\", licenca);\n        }\n      }\n      Mentor.UrlRequest = licenca.urlServidor;\n      _this4.logo = licenca.logo;\n      _this4.storage.get(\"ultimoUsuario\").then(usu => {\n        if (usu == null) return _this4.presentAlert();\n      });\n    })();\n  }\n  navegacao() {\n    var _this5 = this;\n    return _asyncToGenerator(function* () {\n      yield _this5.storage.create();\n      yield _this5.storage.remove(\"licenca\");\n      _this5.router.navigate([\"selecao-municipio\"]);\n    })();\n  }\n};\nLoginPage.ctorParameters = () => [{\n  type: Router\n}, {\n  type: GlobalComponent\n}, {\n  type: Storage\n}, {\n  type: LoadingController\n}, {\n  type: AlertController\n}];\nLoginPage = __decorate([Component({\n  selector: 'app-login',\n  template: __NG_CLI_RESOURCE__0,\n  styles: [__NG_CLI_RESOURCE__1]\n})], LoginPage);\nexport { LoginPage };","map":{"version":3,"mappings":"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","names":["GlobalComponent","Router","Component","Storage","AlertController","Mentor","Funcionarios","servico","Controlador","LoadingController","LoginPage","constructor","router","globalComponent","storage","loadingCtrl","alertController","Array","global","create","message","then","l","load","presentAlert","alert","header","buttons","present","alertaCpf","alertaSenha","loginForm","cpf","undefined","senha","setTimeout","loginForm2","usuario","executaVisao","dismiss","imagem","associadoCras","domicilioCras","historicoUnidades","x","length","dataFimFormatado","unidade","cras","set","usuarioLogado","dataUltimoAcessoAppFormatado","dataUltimoAcessoApp","Date","dateToString","parametro","codigo","palavra","bind","mensagens","eval","stringToDate","publicacaoFormatado","getTime","temMensagemNova","rodaTransacaoFromObjeto","url","navigateByUrl","lServidor","funcionario","ionViewDidEnter","licenca","get","UrlRequest","licencas","estado","sistema","nomeMunicipio","urlServidor","logo","usu","navegacao","remove","navigate","selector","template"],"sourceRoot":"","sources":["/Users/erisveltonlima/Desktop/Projetos 2023/criancaFeliz2023/src/app/pages/login/login.page.ts"],"sourcesContent":["import { GlobalComponent } from './../../global/global.component';\nimport { Router } from '@angular/router';\nimport { Component, OnInit } from '@angular/core';\nimport { FormArray, FormGroup } from '@angular/forms';\nimport { Storage } from '@ionic/storage-angular';\nimport { AlertController } from '@ionic/angular';\nimport { Mentor } from '../../models/Mentor';\nimport { Funcionarios, PcfPlanoVisita, PcfCaracterizacaoCrianca, DomicilioCras, PcfCaracterizacaoGestante, licencaMunicipioSistema } from '../../models/Modelo'\nimport { servico } from '../../models/Servico'\nimport { Controlador } from '../../models/Controlador';\n\nimport { LoadingController } from '@ionic/angular';\n\n\n\n\n@Component({\n  selector: 'app-login',\n  templateUrl: './login.page.html',\n  styleUrls: ['./login.page.scss'],\n})\nexport class LoginPage  {\n\n\n\n  cpf: String = \"037.189.414-06\";\n  senha: String = \"Velton250380\";\n\n  load: any = null;\n\n  global: any;\n  municipio: licencaMunicipioSistema = null;\n\n  logo : String = \"/assets/images/examples/carregamento.png\";\n  simnao: number;\n  servidorLogado: any = null;\n  showSpinner: boolean = false;\n  ctrl: Controlador = new Controlador();\n  enviaDados: boolean;\n  plano: PcfPlanoVisita;\n  criancas: PcfCaracterizacaoCrianca[] = new Array();\n  gestantes: PcfCaracterizacaoGestante[] = new Array();\n\n  constructor(\n    private router: Router,\n    public globalComponent: GlobalComponent,\n    private storage: Storage,\n\t\tprivate loadingCtrl: LoadingController,\n    private alertController: AlertController,\n  ) {\n    \n    this.global = this.globalComponent;\n    loadingCtrl.create({\n      message: \"Conectando Servidor.\"\n    }).then((l=> {this.load = l}))\n\n    \n\n    }\n  \n\n  async presentAlert() {\n    const alert = await this.alertController.create({\n      header: 'Importante',\n      message: \"Para acessar o aplicativo, é preciso estar inscrito no Cadastro Único Federal Procure uma Unidade de Assistência Social (CRAS) ou a Central do Cadastro Único mais próxima.\",\n      buttons: ['OK']\n    });\n\n    \n\n    await alert.present();\n  }\n\n  //alerta para informar o CPF\n  async alertaCpf() {\n    const alert = await this.alertController.create({\n      header: 'Importante',\n      message: \"Por favor, preencha seu CPF corretamente .\",\n      buttons: ['OK']\n    });\n\n    await alert.present();\n  }\n\n  //alerta para informar a senha\n  async alertaSenha() {\n    const alert = await this.alertController.create({\n      header: 'Importante',\n      message: \"Por favor, preencha sua data de nascimento.\",\n      buttons: ['OK']\n    });\n\n    await alert.present();\n  }\n  // form login\n\n  loginForm() {\n  //  console.log('Data Requerida: ', e.value);\n\n    if (this.cpf == '' || this.cpf == undefined) {\n      //this.globalComponent.loadToast('Por favor, preencha seu e-mail corretamente');\n      return this.alertaCpf();\n    } else if (this.senha == '' || this.senha == undefined) {\n      //this.globalComponent.loadToast('Por favor, preencha sua data de nascimento');\n      return this.alertaSenha();\n    } else {\n\n\n      this.load.present();\n      setTimeout(() => {\n        this.loginForm2();\n      }, 100);\n\n      return;\n\n      // tentar fazer login\n\n      var usuario = Mentor.executaVisao(1171, \"varcpf=\" + this.cpf + \"&varsenha=\" + this.senha);\n\n      this.load.dismiss();\n      if (usuario == null) {\n        alert(\"nenhum usuario encontrado\")\n        return;\n      } \n\n\n      servico.imagem\n\n      if(usuario.associadoCras != null && usuario.associadoCras.domicilioCras!= null && usuario.associadoCras.domicilioCras.historicoUnidades != null){\n        for(var x = 0;x<usuario.associadoCras.domicilioCras.historicoUnidades.length;x++)\n          if(usuario.associadoCras.domicilioCras.historicoUnidades[x].dataFimFormatado==\"\" && usuario.associadoCras.domicilioCras.historicoUnidades[x].unidade != null)\n            servico.cras = usuario.associadoCras.domicilioCras.historicoUnidades[x].unidade;\n      }\n\n      this.storage.set(\"ultimoUsuario\",usuario);\n      servico.usuarioLogado = usuario;\n\n      if(usuario.dataUltimoAcessoAppFormatado == null){\n        usuario.dataUltimoAcessoApp = new Date();\n        usuario.dataUltimoAcessoAppFormatado = Mentor.dateToString(new Date());\n      }\n\n      //var mensagens = Mentor.executaVisao(3071, \"\");\n\n      var parametro = \"individuo=\"+servico.usuarioLogado.codigo;\n\n      if(servico.cras != null)    \n        parametro = parametro + \"&unidade=\" + servico.cras.codigo;\n      \n  \n      var palavra = Mentor.bind(parametro,\"/jsp/appCidadao/listaMensagens.jsp\",\"POST\");\n      var mensagens = eval(palavra + \"\");\n\n      if(mensagens != null){\n        for(var x = 0;x<mensagens.length;x++){\n          if(Mentor.stringToDate(mensagens[x].publicacaoFormatado).getTime() > Mentor.stringToDate(usuario.dataUltimoAcessoAppFormatado).getTime())\n            servico.temMensagemNova = true;\n        }\n      }\n\n\n      servico.dataUltimoAcessoApp = Mentor.stringToDate(usuario.dataUltimoAcessoAppFormatado);\n      usuario.dataUltimoAcessoApp = new Date();\n      \n      Mentor.rodaTransacaoFromObjeto(1788,\"obj\", usuario,false);\n\n\n\n      let url = '/tabs/meus-dados';\n      //let url_withparameter = '/tabs/meus-dados?cpf=' + e.value.login_cpf + '&nascimento=' + e.value.login_nascimento;\n\n      this.storage.set('cpf',this.cpf);\n      \n\n      this.router.navigateByUrl(url);\n    }\n  }\n\n\n  loginForm2() {\n    //  console.log('Data Requerida: ', e.value);\n  \n     {\n      // tentar fazer login\n  \n        var lServidor = Mentor.executaVisao(1171, \"varcpf=\" + this.cpf + \"&varsenha=\" + this.senha);\n  \n        if (lServidor == null) {\n\n          var funcionario: Funcionarios = new Funcionarios(lServidor);\n\n          this.storage.set(\"servidor\", funcionario);\n\n        this.load.dismiss();\n          alert(\"nenhum usuario encontrado\")\n          return;\n        } \n  \n  \n        servico.imagem\n  \n        if(lServidor.associadoCras!= null && lServidor.associadoCras.domicilioCras!= null && lServidor.associadoCras.domicilioCras.historicoUnidades != null){\n          for(var x = 0;x<lServidor.associadoCras.domicilioCras.historicoUnidades.length;x++)\n            if(lServidor.associadoCras.domicilioCras.historicoUnidades[x].dataFimFormatado==\"\" && lServidor.associadoCras.domicilioCras.historicoUnidades[x].unidade != null)\n              servico.cras = lServidor.associadoCras.domicilioCras.historicoUnidades[x].unidade;\n        }\n  \n        this.storage.set(\"ultimoUsuario\",lServidor);\n        servico.usuarioLogado = lServidor;\n  \n        if(lServidor.dataUltimoAcessoAppFormatado == null){\n          lServidor.dataUltimoAcessoApp = new Date();\n          lServidor.dataUltimoAcessoAppFormatado = Mentor.dateToString(new Date());\n        }\n  \n        //var mensagens = Mentor.executaVisao(3071, \"\");\n  \n        var parametro = \"individuo=\"+servico.usuarioLogado.codigo;\n  \n        if(servico.cras != null)    \n          parametro = parametro + \"&unidade=\" + servico.cras.codigo;\n        \n    \n        var palavra = Mentor.bind(parametro,\"/jsp/appCidadao/listaMensagens.jsp\",\"POST\");\n        var mensagens = eval(palavra + \"\");\n  \n        if(mensagens != null){\n          for(var x = 0;x<mensagens.length;x++){\n            if(Mentor.stringToDate(mensagens[x].publicacaoFormatado).getTime() > Mentor.stringToDate(lServidor.dataUltimoAcessoAppFormatado).getTime())\n              servico.temMensagemNova = true;\n          }\n        }\n  \n  \n        servico.dataUltimoAcessoApp = Mentor.stringToDate(lServidor.dataUltimoAcessoAppFormatado);\n        lServidor.dataUltimoAcessoApp = new Date();\n        \n        Mentor.rodaTransacaoFromObjeto(1788,\"obj\", lServidor,false);\n  \n  \n  \n        let url = '/tabs/meus-dados';\n        //let url_withparameter = '/tabs/meus-dados?cpf=' + e.value.login_cpf + '&nascimento=' + e.value.login_nascimento;\n  \n        this.storage.set('cpf',this.cpf);\n        \n  \n\n        this.load.dismiss();\n        \n        this.router.navigateByUrl(url);\n      }\n    }\n\n\n\n  async ionViewDidEnter(){\n    await this.storage.create();\n    var licenca: licencaMunicipioSistema = await this.storage.get('licenca');\n    //alert(licenca);\n    if (licenca == null) {\n      this.router.navigateByUrl('selecao-municipio');\n    }\n    else{\n      Mentor.UrlRequest = \"https://app.conectasuas.com.br/assistenciaSocial/\"\n      //\"http://app.vvision.com.br:8080/assistenciaSocial/\";\n      var licencas = Mentor.executaVisao(2632,\"varcodigo=\" + licenca.estado.codigo + \"&varsistema=\" + licenca.sistema + \"&varnomeMunicipio=\" + licenca.nomeMunicipio);\n      if(licencas == null || licencas.length != 1)\n      this.router.navigateByUrl('selecao-municipio');\n      else{\n        licenca = licencas[0];\n        this.storage.set(\"licenca\", licenca);\n      }\n\n    }\n\n    Mentor.UrlRequest = licenca.urlServidor;\n    this.logo = licenca.logo;\n\n    this.storage.get(\"ultimoUsuario\").then(usu => {\n      if(usu == null)\n        return this.presentAlert();\n\n  });\n  }\n\n\n  async navegacao() {\n    await this.storage.create();\n    await this.storage.remove(\"licenca\");\n    this.router.navigate([\"selecao-municipio\"]);\n\n  }\n\n\n  //cpf() {\n  //  this.router.navigate(['/tabs/meus-dados']);\n  // }\n\n}\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}